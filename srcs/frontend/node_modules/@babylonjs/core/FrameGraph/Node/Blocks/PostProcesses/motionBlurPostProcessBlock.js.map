{"version":3,"file":"motionBlurPostProcessBlock.js","sourceRoot":"","sources":["../../../../../../../dev/core/src/FrameGraph/Node/Blocks/PostProcesses/motionBlurPostProcessBlock.ts"],"names":[],"mappings":"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","sourcesContent":["import type { NodeRenderGraphConnectionPoint, Scene, NodeRenderGraphBuildState, FrameGraphTextureHandle, FrameGraph } from \"core/index\";\r\nimport { RegisterClass } from \"../../../../Misc/typeStore\";\r\nimport { NodeRenderGraphBlockConnectionPointTypes } from \"../../Types/nodeRenderGraphTypes\";\r\nimport { editableInPropertyPage, PropertyTypeForEdition } from \"../../../../Decorators/nodeDecorator\";\r\nimport { FrameGraphMotionBlurTask } from \"core/FrameGraph/Tasks/PostProcesses/motionBlurTask\";\r\nimport { ThinMotionBlurPostProcess } from \"core/PostProcesses/thinMotionBlurPostProcess\";\r\nimport { NodeRenderGraphBasePostProcessBlock } from \"./basePostProcessBlock\";\r\n\r\n/**\r\n * Block that implements the motion blur post process\r\n */\r\nexport class NodeRenderGraphMotionBlurPostProcessBlock extends NodeRenderGraphBasePostProcessBlock {\r\n    protected override _frameGraphTask: FrameGraphMotionBlurTask;\r\n\r\n    /**\r\n     * Gets the frame graph task associated with this block\r\n     */\r\n    public override get task() {\r\n        return this._frameGraphTask;\r\n    }\r\n\r\n    /**\r\n     * Create a new NodeRenderGraphMotionBlurPostProcessBlock\r\n     * @param name defines the block name\r\n     * @param frameGraph defines the hosting frame graph\r\n     * @param scene defines the hosting scene\r\n     */\r\n    public constructor(name: string, frameGraph: FrameGraph, scene: Scene) {\r\n        super(name, frameGraph, scene);\r\n\r\n        this.registerInput(\"geomVelocity\", NodeRenderGraphBlockConnectionPointTypes.TextureVelocity, true);\r\n        this.registerInput(\"geomViewDepth\", NodeRenderGraphBlockConnectionPointTypes.TextureViewDepth, true);\r\n\r\n        this._finalizeInputOutputRegistering();\r\n\r\n        this._frameGraphTask = new FrameGraphMotionBlurTask(this.name, frameGraph, new ThinMotionBlurPostProcess(name, frameGraph.scene));\r\n    }\r\n\r\n    /** Defines how much the image is blurred by the movement. */\r\n    @editableInPropertyPage(\"Strength\", PropertyTypeForEdition.Float, \"PROPERTIES\")\r\n    public get motionStrength(): number {\r\n        return this._frameGraphTask.postProcess.motionStrength;\r\n    }\r\n\r\n    public set motionStrength(value: number) {\r\n        this._frameGraphTask.postProcess.motionStrength = value;\r\n    }\r\n\r\n    /** Gets the number of iterations that are used for motion blur quality. */\r\n    @editableInPropertyPage(\"Samples\", PropertyTypeForEdition.Float, \"PROPERTIES\")\r\n    public get motionBlurSamples(): number {\r\n        return this._frameGraphTask.postProcess.motionBlurSamples;\r\n    }\r\n\r\n    public set motionBlurSamples(value: number) {\r\n        this._frameGraphTask.postProcess.motionBlurSamples = value;\r\n    }\r\n\r\n    /** Gets whether or not the motion blur post-process is in object based mode. */\r\n    @editableInPropertyPage(\"Object based\", PropertyTypeForEdition.Boolean, \"PROPERTIES\")\r\n    public get isObjectBased(): boolean {\r\n        return this._frameGraphTask.postProcess.isObjectBased;\r\n    }\r\n\r\n    public set isObjectBased(value: boolean) {\r\n        this._frameGraphTask.postProcess.isObjectBased = value;\r\n    }\r\n\r\n    /**\r\n     * Gets the current class name\r\n     * @returns the class name\r\n     */\r\n    public override getClassName() {\r\n        return \"NodeRenderGraphMotionBlurPostProcessBlock\";\r\n    }\r\n\r\n    /**\r\n     * Gets the geometry velocity input component\r\n     */\r\n    public get geomVelocity(): NodeRenderGraphConnectionPoint {\r\n        return this._inputs[2];\r\n    }\r\n\r\n    /**\r\n     * Gets the geometry view depth input component\r\n     */\r\n    public get geomViewDepth(): NodeRenderGraphConnectionPoint {\r\n        return this._inputs[3];\r\n    }\r\n\r\n    protected override _buildBlock(state: NodeRenderGraphBuildState) {\r\n        super._buildBlock(state);\r\n\r\n        this._frameGraphTask.velocityTexture = this.geomVelocity.connectedPoint?.value as FrameGraphTextureHandle;\r\n        this._frameGraphTask.depthTexture = this.geomViewDepth.connectedPoint?.value as FrameGraphTextureHandle;\r\n    }\r\n\r\n    protected override _dumpPropertiesCode() {\r\n        const codes: string[] = [];\r\n        codes.push(`${this._codeVariableName}.motionStrength = ${this.motionStrength};`);\r\n        codes.push(`${this._codeVariableName}.motionBlurSamples = ${this.motionBlurSamples};`);\r\n        codes.push(`${this._codeVariableName}.isObjectBased = ${this.isObjectBased};`);\r\n        return super._dumpPropertiesCode() + codes.join(\"\\n\");\r\n    }\r\n\r\n    public override serialize(): any {\r\n        const serializationObject = super.serialize();\r\n        serializationObject.motionStrength = this.motionStrength;\r\n        serializationObject.motionBlurSamples = this.motionBlurSamples;\r\n        serializationObject.isObjectBased = this.isObjectBased;\r\n        return serializationObject;\r\n    }\r\n\r\n    public override _deserialize(serializationObject: any) {\r\n        super._deserialize(serializationObject);\r\n        this.motionStrength = serializationObject.motionStrength;\r\n        this.motionBlurSamples = serializationObject.motionBlurSamples;\r\n        this.isObjectBased = serializationObject.isObjectBased;\r\n    }\r\n}\r\n\r\nRegisterClass(\"BABYLON.NodeRenderGraphMotionBlurPostProcessBlock\", NodeRenderGraphMotionBlurPostProcessBlock);\r\n"]}